/*
Jonathan Fessler
Database Concepts, Design and Application
Final Project SQL
4/24/2025
*/

-- Create Database
CREATE DATABASE [MarketMates_Database];
GO

ALTER DATABASE [MarketMates_Database] SET COMPATIBILITY_LEVEL = 150;
GO

IF (1 = FULLTEXTSERVICEPROPERTY('IsFullTextInstalled'))
BEGIN
    EXEC [MarketMates_Database].[dbo].[sp_fulltext_database] @action = 'enable';
END
GO

ALTER DATABASE [MarketMates_Database] SET AUTO_CLOSE OFF;
ALTER DATABASE [MarketMates_Database] SET RECOVERY SIMPLE;
ALTER DATABASE [MarketMates_Database] SET PAGE_VERIFY CHECKSUM;
ALTER DATABASE [MarketMates_Database] SET AUTO_SHRINK OFF;
GO

USE [MarketMates_Database];
GO

-- Table: SUPPLIER
CREATE TABLE [dbo].[SUPPLIER](
    [SUPPLIER_ID] INT NOT NULL PRIMARY KEY,
    [SUPPLIER_NAME] NVARCHAR(255) NOT NULL,
    [SUPPLIER_PHONE_NUMBER] NVARCHAR(20),
    [SUPPLIER_ADDRESS] NVARCHAR(255) NOT NULL,
    [SUPPLIER_CITY] NVARCHAR(100) NOT NULL,
    [SUPPLIER_STATE] NVARCHAR(50) NOT NULL,
    [SUPPLIER_ZIP] NVARCHAR(20) NOT NULL
);
GO

-- Table: PRODUCT
CREATE TABLE [dbo].[PRODUCT](
    [PRODUCT_ID] INT NOT NULL PRIMARY KEY,
    [PRODUCT_NAME] NVARCHAR(255) NOT NULL,
    [PRODUCT_PRICE] DECIMAL(10,2) NOT NULL,
    [PRODUCT_QUANTITY] INT NOT NULL,
    [SUPPLIER_ID] INT NOT NULL,
    CONSTRAINT FK_PRODUCT_SUPPLIER FOREIGN KEY ([SUPPLIER_ID]) REFERENCES [dbo].[SUPPLIER]([SUPPLIER_ID]) ON DELETE CASCADE
);
GO

-- Table: CUSTOMER
CREATE TABLE [dbo].[CUSTOMER](
    [CUSTOMER_ID] INT NOT NULL PRIMARY KEY,
    [CUSTOMER_FNAME] NVARCHAR(100) NOT NULL,
    [CUSTOMER_LNAME] NVARCHAR(100) NOT NULL,
    [CUSTOMER_EMAIL] NVARCHAR(255) NOT NULL,
    [CUSTOMER_PHONE_NUMBER] NVARCHAR(20) NOT NULL,
    [CUSTOMER_ADDRESS] NVARCHAR(255) NOT NULL,
    [CUSTOMER_CITY] NVARCHAR(100) NOT NULL,
    [CUSTOMER_STATE] NVARCHAR(50) NOT NULL,
    [CUSTOMER_ZIP] NVARCHAR(20) NOT NULL
);
GO

-- Table: DEPARTMENT
CREATE TABLE [dbo].[DEPARTMENT](
    [DEPARTMENT_ID] INT NOT NULL PRIMARY KEY,
    [DEPARTMENT_NAME] NVARCHAR(100) NOT NULL,
    [DEPARTMENT_DESCRIPTION] NVARCHAR(255) NOT NULL
);
GO

-- Table: EMPLOYEE
CREATE TABLE [dbo].[EMPLOYEE](
    [EMPLOYEE_ID] INT NOT NULL PRIMARY KEY,
    [EMPLOYEE_FNAME] NVARCHAR(100) NOT NULL,
    [EMPLOYEE_LNAME] NVARCHAR(100) NOT NULL,
    [EMPLOYEE_EMAIL] NVARCHAR(255) NOT NULL,
    [EMPLOYEE_PHONE_NUMBER] NVARCHAR(20) NOT NULL,
    [EMPLOYEE_HIRE_DATE] DATE NOT NULL,
    [EMPLOYEE_SALARY] DECIMAL(10,2) NOT NULL,
    [DEPARTMENT_ID] INT NULL,
    [MANAGER_ID] INT NULL,
    [MANAGER_START_DATE] DATE NOT NULL,
    CONSTRAINT FK_EMPLOYEE_DEPARTMENT FOREIGN KEY ([DEPARTMENT_ID]) REFERENCES [dbo].[DEPARTMENT]([DEPARTMENT_ID]) ON DELETE SET NULL
);
GO

-- Table: EMPLOYEE_SALARY_HISTORY
CREATE TABLE [dbo].[EMPLOYEE_SALARY_HISTORY](
    [EMP_NUM] INT NOT NULL,
    [SALARY_START_DATE] DATE NOT NULL,
    [SALARY_AMOUNT] DECIMAL(10,2) NOT NULL,
    CONSTRAINT PK_EMP_SALARY_HISTORY PRIMARY KEY ([EMP_NUM], [SALARY_START_DATE]),
    CONSTRAINT FK_SALARY_EMPLOYEE FOREIGN KEY ([EMP_NUM]) REFERENCES [dbo].[EMPLOYEE]([EMPLOYEE_ID]) ON DELETE CASCADE
);
GO

-- Table: CUSTOMER_ORDER
CREATE TABLE [dbo].[CUSTOMER_ORDER](
    [ORDER_ID] INT NOT NULL PRIMARY KEY,
    [CUSTOMER_ID] INT NOT NULL,
    [EMPLOYEE_ID] INT NULL,
    [ORDER_DATE] DATE NOT NULL,
    [ORDER_COST] DECIMAL(10,2) NOT NULL,
    [ORDER_STATUS] NVARCHAR(20) NOT NULL,
    CONSTRAINT FK_ORDER_CUSTOMER FOREIGN KEY ([CUSTOMER_ID]) REFERENCES [dbo].[CUSTOMER]([CUSTOMER_ID]) ON DELETE CASCADE,
    CONSTRAINT FK_ORDER_EMPLOYEE FOREIGN KEY ([EMPLOYEE_ID]) REFERENCES [dbo].[EMPLOYEE]([EMPLOYEE_ID]) ON DELETE SET NULL
);
GO

-- Insert data: SUPPLIER
INSERT INTO [dbo].[SUPPLIER] VALUES
(1001, 'Tech Supplies Ltd.', '(415) 432-1234', '1234 Silicon Blvd', 'San Francisco', 'CA', '94105'),
(1002, 'Fresh Market Co.', '(310) 876-5432', '456 Greenfield Rd', 'Los Angeles', 'CA', '90001'),
(1003, 'Gadget Galaxy', '(512) 321-6789', '789 Innovation St', 'Austin', 'TX', '73301'),
(1004, 'Auto Parts Plus', '(313) 654-4321', '101 Mechanic Ave', 'Detroit', 'MI', '48201'),
(1005, 'Home Essentials Corp.', '(312) 987-6543', '202 Comfort Ln', 'Chicago', 'IL', '60601');
GO

-- Insert data: PRODUCT
INSERT INTO [dbo].[PRODUCT] VALUES
(2001, 'HP Spectre Laptop', 1299.99, 50, 1001),
(2002, 'Organic Fuji Apples', 2.99, 1000, 1002),
(2003, 'Samsung Galaxy S22', 799.99, 200, 1003),
(2004, 'Ceramic Brake Pads', 79.99, 150, 1004),
(2005, 'Samsung Microwave Oven', 199.99, 120, 1005);
GO

-- Insert data: CUSTOMER
INSERT INTO [dbo].[CUSTOMER] VALUES
(3001, 'James', 'Anderson', 'james.anderson@gmail.com', '(212) 123-4567', '1234 Elm St', 'New York', 'NY', '10001'),
(3002, 'Olivia', 'Martinez', 'olivia.martinez@hotmail.com', '(619) 567-8901', '4567 Oak St', 'San Diego', 'CA', '92101'),
(3003, 'Ethan', 'Brown', 'ethan.brown@icloud.com', '(214) 901-2345', '789 Pine Rd', 'Dallas', 'TX', '75201'),
(3004, 'Sophia', 'Williams', 'sophia.williams@gmail.com', '(305) 345-6789', '1012 Maple Ave', 'Miami', 'FL', '33101'),
(3005, 'Lucas', 'Davis', 'lucas.davis@gmail.com', '(206) 789-0123', '2023 Cedar Ln', 'Seattle', 'WA', '98101');
GO

-- Insert data: DEPARTMENT
INSERT INTO [dbo].[DEPARTMENT] VALUES
(4001, 'Sales', 'Handles customer sales and inquiries'),
(4002, 'IT', 'Supports network, software, and hardware systems'),
(4003, 'Human Resources', 'Manages employee welfare and recruitment'),
(4004, 'Finance', 'Handles financial planning and reporting'),
(4005, 'Marketing', 'Creates campaigns to promote products');
GO

-- Insert data: EMPLOYEE
INSERT INTO [dbo].[EMPLOYEE] VALUES
(5001, 'Alice', 'Johnson', 'alice.johnson@gmail.com', '(202) 111-2222', '2022-08-10', 55000.00, 4001, NULL, '2022-08-10'),
(5002, 'Robert', 'Evans', 'robert.evans@gmail.com', '(303) 222-3333', '2021-07-15', 70000.00, 4002, NULL, '2021-07-15'),
(5003, 'Charlie', 'Davis', 'charlie.davis@outlook.com', '(404) 333-4444', '2020-05-20', 48000.00, 4003, 5002, '2020-05-20'),
(5004, 'David', 'Lee', 'david.lee@outlook.com', '(505) 444-5555', '2021-10-01', 65000.00, 4004, 5001, '2021-10-01'),
(5005, 'Eva', 'Wilson', 'eva.wilson@gmail.com', '(606) 555-6666', '2022-11-01', 59000.00, 4005, 5002, '2022-11-01');
GO

-- Insert data: EMPLOYEE_SALARY_HISTORY
INSERT INTO [dbo].[EMPLOYEE_SALARY_HISTORY] VALUES
(5001, '2022-08-10', 55000.00),
(5002, '2021-07-15', 70000.00),
(5003, '2020-05-20', 48000.00),
(5004, '2021-10-01', 65000.00),
(5005, '2022-11-01', 59000.00);
GO

-- Insert data: CUSTOMER_ORDER
INSERT INTO [dbo].[CUSTOMER_ORDER] VALUES
(6001, 3001, 5001, '2025-04-10', 1099.99, 'Completed'),
(6002, 3002, 5002, '2025-04-11', 299.99, 'Processing'),
(6003, 3003, 5003, '2025-04-12', 899.99, 'Completed'),
(6004, 3004, 5004, '2025-04-13', 179.99, 'Shipped'),
(6005, 3005, 5005, '2025-04-14', 219.99, 'Shipped');
GO


-- Select All Data from SUPPLIER
SELECT * FROM [dbo].[SUPPLIER];

-- Select All Data from PRODUCT
SELECT 
    p.PRODUCT_ID,
    p.PRODUCT_NAME,
    FORMAT(p.PRODUCT_PRICE, 'C', 'en-US') AS PRODUCT_PRICE,
    p.PRODUCT_QUANTITY,
    s.SUPPLIER_NAME
FROM [dbo].[PRODUCT] p
JOIN [dbo].[SUPPLIER] s ON p.SUPPLIER_ID = s.SUPPLIER_ID;

-- Select All Data from CUSTOMER
SELECT * FROM [dbo].[CUSTOMER];

-- Select All Data from DEPARTMENT
SELECT * FROM [dbo].[DEPARTMENT];

-- Select All Data from EMPLOYEE
SELECT 
    e.EMPLOYEE_FNAME + ' ' + e.EMPLOYEE_LNAME AS EMPLOYEE_NAME,
    e.EMPLOYEE_EMAIL,
    e.EMPLOYEE_PHONE_NUMBER,
    FORMAT(e.EMPLOYEE_SALARY, 'C', 'en-US') AS EMPLOYEE_SALARY,
    d.DEPARTMENT_NAME,
    m.EMPLOYEE_FNAME + ' ' + m.EMPLOYEE_LNAME AS MANAGER_NAME
FROM [dbo].[EMPLOYEE] e
JOIN [dbo].[DEPARTMENT] d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
LEFT JOIN [dbo].[EMPLOYEE] m ON e.MANAGER_ID = m.EMPLOYEE_ID;

-- Select All Data from EMPLOYEE_SALARY_HISTORY
SELECT 
    e.EMPLOYEE_FNAME + ' ' + e.EMPLOYEE_LNAME AS EMPLOYEE_NAME,
    esh.SALARY_START_DATE,
    FORMAT(esh.SALARY_AMOUNT, 'C', 'en-US') AS SALARY_AMOUNT
FROM [dbo].[EMPLOYEE_SALARY_HISTORY] esh
JOIN [dbo].[EMPLOYEE] e ON esh.EMP_NUM = e.EMPLOYEE_ID;

-- Select All Data from CUSTOMER_ORDER
SELECT 
    o.ORDER_ID,
    o.ORDER_DATE,
    FORMAT(o.ORDER_COST, 'C', 'en-US') AS ORDER_COST,
    o.ORDER_STATUS,
    c.CUSTOMER_FNAME + ' ' + c.CUSTOMER_LNAME AS CUSTOMER_NAME,
    e.EMPLOYEE_FNAME + ' ' + e.EMPLOYEE_LNAME AS EMPLOYEE_NAME
FROM [dbo].[CUSTOMER_ORDER] o
JOIN [dbo].[CUSTOMER] c ON o.CUSTOMER_ID = c.CUSTOMER_ID
LEFT JOIN [dbo].[EMPLOYEE] e ON o.EMPLOYEE_ID = e.EMPLOYEE_ID;

-- List of Products and Suppliers
SELECT 
    p.PRODUCT_ID,
    p.PRODUCT_NAME,
    FORMAT(p.PRODUCT_PRICE, 'C', 'en-US') AS PRODUCT_PRICE,
    p.PRODUCT_QUANTITY,
    s.SUPPLIER_NAME
FROM [dbo].[PRODUCT] p
JOIN [dbo].[SUPPLIER] s ON p.SUPPLIER_ID = s.SUPPLIER_ID;

-- List of Orders with Customer and Employee Details
SELECT 
    o.ORDER_ID,
    o.ORDER_DATE,
    FORMAT(o.ORDER_COST, 'C', 'en-US') AS ORDER_COST,
    o.ORDER_STATUS,
    c.CUSTOMER_FNAME + ' ' + c.CUSTOMER_LNAME AS CUSTOMER_NAME,
    e.EMPLOYEE_FNAME + ' ' + e.EMPLOYEE_LNAME AS EMPLOYEE_NAME
FROM [dbo].[CUSTOMER_ORDER] o
JOIN [dbo].[CUSTOMER] c ON o.CUSTOMER_ID = c.CUSTOMER_ID
LEFT JOIN [dbo].[EMPLOYEE] e ON o.EMPLOYEE_ID = e.EMPLOYEE_ID;

-- List of Employees with Their Department and Manager Details
SELECT 
    e.EMPLOYEE_FNAME + ' ' + e.EMPLOYEE_LNAME AS EMPLOYEE_NAME,
    d.DEPARTMENT_NAME,
    m.EMPLOYEE_FNAME + ' ' + m.EMPLOYEE_LNAME AS MANAGER_NAME
FROM [dbo].[EMPLOYEE] e
JOIN [dbo].[DEPARTMENT] d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
LEFT JOIN [dbo].[EMPLOYEE] m ON e.MANAGER_ID = m.EMPLOYEE_ID;

-- List of Employees with Their Salary History
SELECT 
    e.EMPLOYEE_FNAME + ' ' + e.EMPLOYEE_LNAME AS EMPLOYEE_NAME,
    esh.SALARY_START_DATE,
    FORMAT(esh.SALARY_AMOUNT, 'C', 'en-US') AS SALARY_AMOUNT
FROM [dbo].[EMPLOYEE_SALARY_HISTORY] esh
JOIN [dbo].[EMPLOYEE] e ON esh.EMP_NUM = e.EMPLOYEE_ID;

-- List of Customers with Their Orders
SELECT 
    c.CUSTOMER_FNAME + ' ' + c.CUSTOMER_LNAME AS CUSTOMER_NAME,
    o.ORDER_ID,
    o.ORDER_DATE,
    FORMAT(o.ORDER_COST, 'C', 'en-US') AS ORDER_COST,
    o.ORDER_STATUS
FROM [dbo].[CUSTOMER] c
JOIN [dbo].[CUSTOMER_ORDER] o ON c.CUSTOMER_ID = o.CUSTOMER_ID;

-- Employees with Their Salary Changes
SELECT 
    e.EMPLOYEE_FNAME + ' ' + e.EMPLOYEE_LNAME AS EMPLOYEE_NAME,
    esh.SALARY_START_DATE,
    FORMAT(esh.SALARY_AMOUNT, 'C', 'en-US') AS SALARY_AMOUNT
FROM [dbo].[EMPLOYEE_SALARY_HISTORY] esh
JOIN [dbo].[EMPLOYEE] e ON esh.EMP_NUM = e.EMPLOYEE_ID
ORDER BY e.EMPLOYEE_FNAME, esh.SALARY_START_DATE;

-- List of Employees with Historical Salary Changes
SELECT 
    e.EMPLOYEE_FNAME + ' ' + e.EMPLOYEE_LNAME AS EMPLOYEE_NAME,
    esh.SALARY_START_DATE,
    FORMAT(esh.SALARY_AMOUNT, 'C', 'en-US') AS SALARY_AMOUNT
FROM [dbo].[EMPLOYEE] e
LEFT JOIN [dbo].[EMPLOYEE_SALARY_HISTORY] esh ON e.EMPLOYEE_ID = esh.EMP_NUM
ORDER BY e.EMPLOYEE_FNAME, esh.SALARY_START_DATE;
